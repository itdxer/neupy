<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="NeuPy is a Python library for Artificial Neural Networks. NeuPy supports many different types of Neural Networks from a simple perceptron to deep learning models.">
        <meta name="viewport" content="width=device-width">
        <title>Image classification, MNIST digits &mdash; NeuPy</title>
            <link rel="stylesheet" href="../../../_static/normalize.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/sphinx.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/main.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/flat.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="../../../_static/font-awesome.min.css" type="text/css">
        <link rel="shortcut icon" href="../../../_static/favicon.ico" /><!-- Load modernizr and JQuery -->
        <script src="../../../_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../../../_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="../../../_static/plugins.js"></script>
        <script src="../../../_static/main.js"></script>
        <link rel="next" title="Password recovery" href="../../../2015/09/21/password_recovery.html" /><link rel="prev" title="Hyperparameter optimization for Neural Networks" href="../../12/17/hyperparameter_optimization_for_neural_networks.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="../../../_static/underscore.js"></script><script type="text/javascript" src="../../../_static/doctools.js"></script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/javascript" src="../../../_static/disqus.js"></script><script type="text/javascript" src="../../../_static/js/google_analytics.js"></script><script type="text/javascript" src="../../../_static/js/script.js"></script><script type="text/javascript" src="../../../_static/js/copybutton.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            // Scroll to content if on small screen
            if (screen.width < 480)
            {
                $(document).scrollTop(document.getElementsByTagName("article")[0].offsetTop - 44);
            }
        });
    </script>
    <style media="screen" type="text/css">
        img { max-width: 800px !important; }
        img[src="../_images/mnist-code-sample-home.png"] { max-width: 600px !important; }
        table { background-color: white; }

        .limited-width { max-width: 800px; margin: auto; }
        .docutils { width: 100%; }
        .docutils td { padding: 10px; }
        .section { word-wrap:break-word; }
        .descname { font-weight: bold; }
        .highlight-python + .figure { margin-top: 20px; }
        .dataframe { text-align: center !important; width: 100%; margin: 10px 0 10px 0; }
        .dataframe td { padding: 5px; }

        .math .gd { color: #000 !important; } /* Generic.Deleted */
        .math .m { color: #000 !important; } /* Literal.Number */
        .math .s { color: #000 !important; } /* Literal.String */
        .math .mf { color: #000 !important; } /* Literal.Number.Float */
        .math .mh { color: #000 !important; } /* Literal.Number.Hex */
        .math .mi { color: #000 !important; } /* Literal.Number.Integer */
        .math .mo { color: #000 !important; } /* Literal.Number.Oct */
        .math .sc { color: #000 !important; } /* Literal.String.Char */
        .math .s2 { color: #000 !important; } /* Literal.String.Double */
        .math .si { color: #000 !important; } /* Literal.String.Interpol */
        .math .sx { color: #000 !important; } /* Literal.String.Other */
        .math .s1 { color: #000 !important; } /* Literal.String.Single */
        .math .ss { color: #000 !important; } /* Literal.String.Symbol */
        .math .il { color: #000 !important; } /* Literal.Number.Integer.Long */

        /* Background for class and function names */
        dt[id^="neupy."] {
            background-color: #e6edf2;
            border: 1px solid #f8fafb;
            border-radius: 8px;
            padding: 10px 20px;
        }
        div[id^="module-neupy."] h1 {
            display: none;
        }

        /* Search input field */
        .search-input {
            width: 100%;
            padding: 10px;
            display: block;
        }
        .box {
          padding-bottom: 50px;
        }
        .search-input-container {
          width: 100%;
          vertical-align: middle;
          white-space: nowrap;
          position: relative;
        }
        .search-input-container input#search {
          width: 100%;
          height: 50px;
          padding-left: 45px;

          float: left;
          outline: none;
          border: 1px solid #ddd;

          box-sizing: border-box;
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;

          -webkit-border-radius: 5px;
          -moz-border-radius: 5px;
          border-radius: 5px;

          font-family: 'PT Sans', Helvetica, Arial, sans-serif;
          font-size: 12pt;
        }
        .search-input-container .icon {
          position: absolute;
          left: 0;
          top: 50%;
          margin-left: 17px;
          margin-top: 13px;
          z-index: 1;
          color: #93a4ad;
        }

        .docutils.field-list, .docutils.footnote {
            background-color: inherit;
        }
        .large-font {
            font-size: 1.4em !important;
        }
        .right-tag {
            float: right;
            margin-left: 36px !important;
            margin-right: 0px !important;
        }
        .short-description {
            /* We hidde description inside of the article */
            display: none;
        }
        .short-description img {
            max-height: 160px;
            max-width: 40% !important;
            margin-left: 8px;
        }
        #results-list ul.search {
            padding: 0;
            max-width: 900px;
            margin: auto;
        }

        #results-list .short-description {
            /* We show description text in the archive */
            display: block !important;
        }
        #results-list li p {
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        #results-list li {
            background-color: #fff !important;
            margin-bottom: 10px;
            display: block !important;
            padding: 15px;
            border-bottom: 2px solid #ddd;
        }
        #results-list span.tag {
            display: inline-block;
            padding: 3px 4px;
            margin-right: 8px;
            position: relative;
            top: -2px;

            background: #888;
            color: #fff;

            font-size: 0.75em;
            font-weight: 600;
            line-height: 1;
            text-transform: uppercase;

            -webkit-border-radius: 2px;
            -moz-border-radius: 2px;
            border-radius: 2px;
        }
    </style></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><header role="banner">
        <div>
          <h1><a href="../../../pages/home.html">NeuPy</a></h1>
          <h2>Neural Networks in Python</h2>
        </div>
    </header>
    <nav role="navigation">
      <ul>
        <li class="main-nav">
          <a href="../../../archive.html">Articles</a>
        </li>
        <li class="main-nav">
          <a href="../../../docs/tutorials.html">Tutorials</a>
        </li>
        <li class="main-nav">
          <a href="../../../pages/documentation.html">Documentation</a>
        </li>
        <li class="main-nav">
          <a href="../../../pages/cheatsheet.html">Cheat sheet</a>
        </li>
        <li class="main-nav">
          <a href="../../../pages/model_zoo.html">Model Zoo</a>
        </li>
      </ul>
    </nav>

<div class="main-container" role="main"><div class="main wrapper body clearfix"><article><div class="timestamp postmeta">
            <span>November 12, 2016</span>
        </div>
    <div class="section" id="image-classification-mnist-digits">
<span id="mnist-classification"></span><h1>Image classification, MNIST digits</h1>
<div class="short-description">
    <p>
    This short tutorial shows how to design and train simple network for digit classification in NeuPy.
    </p>
</div><img alt="MNIST digits example" class="align-center" src="../../../_images/random-digits.png" />
<p>This short tutorial shows how to build and train simple network for digit classification in NeuPy.</p>
<div class="section" id="data-preparation">
<h2>Data preparation</h2>
<p>Data can be loaded in different ways. I used scikit-learn to fetch the MNIST dataset.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mnist</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_mldata</span><span class="p">(</span><span class="s1">&#39;MNIST original&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mnist</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
<p>Now that we have the data we need to confirm that we have expected number of samples.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(70000, 784)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(70000,)</span>
</pre></div>
</div>
<p>Every data sample has 784 features and they can be reshaped into 28x28 image.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/digit-example.png"><img alt="MNIST digit example" class="align-center" src="../../../_images/digit-example.png" style="width: 70%;" /></a>
<p>In this tutorial, we will use each image as a vector so we won&#8217;t need to reshape it to its original size. The only thing that we need to do is to rescale image values. Rescaling images will help network to converge faster.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">/=</span> <span class="mf">255.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span> <span class="o">-=</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice the way division and subtraction are specified. In this way, we make update directly on the <span class="docutils literal"><span class="pre">X</span></span> matrix without copying it. It can be validated with simple example.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">id</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>  <span class="c1"># numbers will be different between runs</span>
<span class="go">4486892960</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">-=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">id</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>  <span class="c1"># object ID didn&#39;t change</span>
<span class="go">4486892960</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">id</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>  <span class="c1"># and now it&#39;s different, because it&#39;s different object</span>
<span class="go">4602409968</span>
</pre></div>
</div>
<p>After last update for matrix <span class="docutils literal"><span class="pre">A</span></span> we got different identifier for the object, which means that it got copied.</p>
<p>In case of the in-place updates, we don&#8217;t waste memory. Current dataset is relatively small and there is no memory deficiency, but for larger datasets it might make a big difference.</p>
<p>There is one more processing step that we need to do before we can train our network. Let&#8217;s take a look into target classes.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">random</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span>
<span class="go">[9, 0, 9, 7, 2, 2, 3, 0, 0, 8]</span>
</pre></div>
</div>
<p>All the numbers that we have are specified as integers. For our problem we want network to learn visual representation of the numbers. We cannot use them as integers, because it will create problems during the training. Basically, with the integer definition we&#8217;re implying that number <span class="docutils literal"><span class="pre">1</span></span> visually more similar to <span class="docutils literal"><span class="pre">0</span></span> than to number <span class="docutils literal"><span class="pre">7</span></span>. It happens only because difference between <span class="docutils literal"><span class="pre">1</span></span> and <span class="docutils literal"><span class="pre">0</span></span> smaller than difference between <span class="docutils literal"><span class="pre">1</span></span> and <span class="docutils literal"><span class="pre">7</span></span>. In order to avoid making any type of assumptions we will use one-hot encoding technique.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(70000, 10)</span>
</pre></div>
</div>
<p>You can see that every digit was transformed into a 10 dimensional vector.</p>
<p>And finally, we need to divide our data into training and validation set. We won&#8217;t show validation set to the network and we will use it only to test network&#8217;s classification accuracy.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">X</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">y</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">test_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">7.</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that data was converted into 32 bit float numbers. This is the only float type that currently supported by NeuPy.</p>
</div>
<div class="section" id="model-initialization">
<h2>Model initialization</h2>
<p>It&#8217;s very easy to define neural network architectures in the NeuPy. We can define simple architecture that excepts input vector with 784 features and outputs probabilities per each digit class. In addition, we can two hidden layers with 500 and 300 output units respectively. Each hidden layer will use relu as activation function</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">neupy.layers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">network</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span>
    <span class="c1"># Every image in the MNIST dataset has 784 pixels (28x28)</span>
    <span class="n">Input</span><span class="p">(</span><span class="mi">784</span><span class="p">),</span>

    <span class="c1"># Hidden layers</span>
    <span class="n">Relu</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">Relu</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span>

    <span class="c1"># Softmax layer ensures that we output probabilities</span>
    <span class="c1"># and specified number of outputs equal to the unique</span>
    <span class="c1"># number of classes</span>
    <span class="n">Softmax</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Because our neural network is quite small, we can rewrite this architecture with a help of the inline operator.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">network</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="mi">784</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">Relu</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">Relu</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">Softmax</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have our architecture we can initialize training algorithm.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">neupy</span> <span class="kn">import</span> <span class="n">algorithms</span>

<span class="n">mnet</span> <span class="o">=</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">Momentum</span><span class="p">(</span>
    <span class="n">network</span><span class="p">,</span>

    <span class="c1"># Categorical cross-entropy is very popular loss function</span>
    <span class="c1"># for the multi-class classification problems</span>
    <span class="n">error</span><span class="o">=</span><span class="s1">&#39;categorical_crossentropy&#39;</span><span class="p">,</span>

    <span class="c1"># Number of samples propagated through the network</span>
    <span class="c1"># before every weight update</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>

    <span class="c1"># Learning rate</span>
    <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>

    <span class="c1"># Makes sure that training progress will be</span>
    <span class="c1"># printed in the terminal</span>
    <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

    <span class="c1"># Training data will be shuffled before every epoch</span>
    <span class="c1"># It ensures that every batch will have different number of samples</span>
    <span class="n">shuffle_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>

    <span class="c1"># Options specific for the momentum training algorithm</span>
    <span class="n">momentum</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span>
    <span class="n">nesterov</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>All the most important information related to the neural network you can find in the terminal output. If you run the code that shown above you should see output similar to the one shown below.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Main</span> <span class="n">information</span>

<span class="p">[</span><span class="n">ALGORITHM</span><span class="p">]</span> <span class="n">Momentum</span>

<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">epoch_end_signal</span> <span class="o">=</span> <span class="bp">None</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">show_epoch</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">shuffle_data</span> <span class="o">=</span> <span class="bp">True</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">step</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">train_end_signal</span> <span class="o">=</span> <span class="bp">None</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">error</span> <span class="o">=</span> <span class="n">categorical_crossentropy</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">addons</span> <span class="o">=</span> <span class="bp">None</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">momentum</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="p">[</span><span class="n">OPTION</span><span class="p">]</span> <span class="n">nesterov</span> <span class="o">=</span> <span class="bp">True</span>

<span class="p">[</span><span class="n">TENSORFLOW</span><span class="p">]</span> <span class="n">Initializing</span> <span class="n">Tensorflow</span> <span class="n">variables</span> <span class="ow">and</span> <span class="n">functions</span><span class="o">.</span>
<span class="p">[</span><span class="n">TENSORFLOW</span><span class="p">]</span> <span class="n">Initialization</span> <span class="n">finished</span> <span class="n">successfully</span><span class="o">.</span> <span class="n">It</span> <span class="n">took</span> <span class="mf">0.30</span> <span class="n">seconds</span>
</pre></div>
</div>
<p>In addition, for feedforward neural networks it&#8217;s possible to check architecture in form of a table.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mnet</span><span class="o">.</span><span class="n">architecture</span><span class="p">()</span>

<span class="go">Network&#39;s architecture</span>

<span class="go">-----------------------------------------------</span>
<span class="go">| # | Input shape | Layer type | Output shape |</span>
<span class="go">-----------------------------------------------</span>
<span class="go">| 1 |         784 |      Input |          784 |</span>
<span class="go">| 2 |         784 |       Relu |          500 |</span>
<span class="go">| 3 |         500 |       Relu |          300 |</span>
<span class="go">| 4 |         300 |    Softmax |           10 |</span>
<span class="go">-----------------------------------------------</span>
</pre></div>
</div>
</div>
<div class="section" id="training">
<h2>Training</h2>
<p>Now that we have everything specified we are finally can train our network. In addition, we can add test data for which we will be able to monitor network&#8217;s training progress on the unseen data.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mnet</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="go">Start training</span>

<span class="go">[TRAINING DATA] shapes: (60000, 784)</span>
<span class="go">[TEST DATA] shapes: (10000, 784)</span>
<span class="go">[TRAINING] Total epochs: 10</span>

<span class="go">---------------------------------------------------------</span>
<span class="go">|    Epoch    |  Train err  |  Valid err  |    Time     |</span>
<span class="go">---------------------------------------------------------</span>
<span class="go">|           1 |     0.27667 |    0.099501 |       2 sec |</span>
<span class="go">|           2 |    0.068402 |    0.089827 |       2 sec |</span>
<span class="go">|           3 |    0.037638 |    0.080401 |       2 sec |</span>
<span class="go">|           4 |    0.023067 |     0.07487 |       2 sec |</span>
<span class="go">|           5 |    0.014583 |    0.069704 |       2 sec |</span>
<span class="go">|           6 |   0.0083044 |      0.0672 |       2 sec |</span>
<span class="go">|           7 |   0.0037654 |    0.068787 |       2 sec |</span>
<span class="go">|           8 |   0.0019174 |    0.071364 |       2 sec |</span>
<span class="go">|           9 |   0.0010768 |    0.071117 |       2 sec |</span>
<span class="go">|          10 |  0.00082685 |     0.07037 |       2 sec |</span>
<span class="go">---------------------------------------------------------</span>
</pre></div>
</div>
</div>
<div class="section" id="evaluations">
<h2>Evaluations</h2>
<p>From the table it&#8217;s hard to see network&#8217;s training progress. We can make error plot that can help us to visualize how it performed on the training and validation datasets separately.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">neupy</span> <span class="kn">import</span> <span class="n">plots</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plots</span><span class="o">.</span><span class="n">error_plot</span><span class="p">(</span><span class="n">mnet</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/bpnet-train-errors-plot.png"><img alt="GradientDescent epoch errors plot" class="align-center" src="../../../_images/bpnet-train-errors-plot.png" style="width: 70%;" /></a>
<p>From the figure above, you can notice that validation error does not decrease all the time. Sometimes it goes up and sometimes down, but it doesn&#8217;t mean that network trains poorly. Let&#8217;s check small example that can explain who it can happen.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">actual_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model1_prediction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model2_prediction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
</pre></div>
</div>
<p>Above, you can see two predictions from different models. The first model predicted two samples right and one wrong. The second one predicted everything perfectly, but predictions from second model are less certain (probabilities are close to random prediction - <span class="docutils literal"><span class="pre">0.5</span></span>). Let&#8217;s check the binary cross entropy error.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">log_loss</span> <span class="k">as</span> <span class="n">binary_crossentropy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">binary_crossentropy</span><span class="p">(</span><span class="n">actual_values</span><span class="p">,</span> <span class="n">model1_prediction</span><span class="p">)</span>
<span class="go">0.37567</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">binary_crossentropy</span><span class="p">(</span><span class="n">actual_values</span><span class="p">,</span> <span class="n">model2_prediction</span><span class="p">)</span>
<span class="go">0.51083</span>
</pre></div>
</div>
<p>The second model made better prediction in terms of accuracy, but it got larger cross entropy error. Larger error means that network is less certain about its prediction. Similar situation we&#8217;ve observed in the plot above.</p>
<p>Instead of using cross-entropy error for model performance assessment we can build our own report using functions available in scikit-learn library.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y_predicted</span> <span class="o">=</span> <span class="n">mnet</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y_actual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">))</span>
<span class="go">              precision    recall  f1-score   support</span>

<span class="go">           0       0.99      0.99      0.99       972</span>
<span class="go">           1       0.99      0.99      0.99      1130</span>
<span class="go">           2       0.99      0.98      0.98       997</span>
<span class="go">           3       0.99      0.98      0.98      1061</span>
<span class="go">           4       0.97      0.99      0.98       966</span>
<span class="go">           5       0.98      0.98      0.98       865</span>
<span class="go">           6       0.99      0.99      0.99      1029</span>
<span class="go">           7       0.98      0.99      0.98      1017</span>
<span class="go">           8       0.98      0.98      0.98       952</span>
<span class="go">           9       0.97      0.98      0.98      1011</span>

<span class="go">   micro avg       0.98      0.98      0.98     10000</span>
<span class="go">   macro avg       0.98      0.98      0.98     10000</span>
<span class="go">weighted avg       0.98      0.98      0.98     10000</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">score</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;Validation accuracy: {:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score</span><span class="p">))</span>
<span class="go">Validation accuracy: 98.37%</span>
</pre></div>
</div>
<p>The 98.37% accuracy is pretty good accuracy for such a simple solution. Additional modification can improve network&#8217;s accuracy.</p>
</div>
</div>

    <div class="postmeta">
        <div class="author">
            <span>Posted by Yurii Shevchuk</span>
        </div>
        
        <div class="tags">
            <span>
                Tags:
                <a href="../../../tags/classification.html">classification</a>, <a href="../../../tags/tutorials.html">tutorials</a>, <a href="../../../tags/supervised.html">supervised</a>, <a href="../../../tags/backpropagation.html">backpropagation</a>, <a href="../../../tags/image_recognition.html">image recognition</a>, <a href="../../../tags/deep_learning.html">deep learning</a></span>
        </div>
        </div><ul class="related clearfix">
            <li class="left"> &laquo; <a href="../../12/17/hyperparameter_optimization_for_neural_networks.html">Hyperparameter optimization for Neural Networks</a></li>
            <li class="right"><a href="../../../2015/09/21/password_recovery.html">Password recovery</a> &raquo; </li>
        </ul><div id="disqus_thread"></div><script type="text/javascript">    var disqus_shortname = "neupy";    var disqus_identifier = "2016/11/12/mnist_classification";    disqus_thread();</script><noscript>Please enable JavaScript to view the    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></article><aside class="sidebar"><section><div class="widget" id="searchbox" role="search">
    <h1><a href="#searchbox">Search</a></h1>
    <form action="../../../search.html" method="get">
          <div class="box">
            <div class="search-input-container">
                <span class="icon"><i class="fa fa-search"></i></span>
                <input type="search" name="q" id="search" placeholder="Search..." />
            </div>
          </div>
    </form>
</div></section><section><div class="widget">
    <h1>Install NeuPy</h1>
    <div class="highligh-bash">
        <div class="highlight">
            <pre>pip install neupy</pre>
        </div>
    </div>
    <p>
        <div>Learn more about NeuPy reading <a href="../../../docs/tutorials.html">tutorials</a> and <a href="../../../pages/documentation.html">documentation</a>.</div>
    </p>
</div></section><section><div class="widget">
    <h1>Issues and feature requests</h1>
    <p>
        If you find a bug or want to suggest a new feature feel free to
        <a href="https://github.com/itdxer/neupy/issues/new">create an issue</a>
        on Github
    </p>
</div></section><section><div class="widget">
    <h1>Old NeuPy versions</h1>
    <p>
        <div>Documentation for the old NeuPy versions you can find <a href="../../../pages/versions.html">here</a>.</div>
    </p>
</div></section></aside></div> <!-- #main --></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo"><footer class="wrapper">&copy; Copyright 2015 - 2019, Yurii Shevchuk. Powered by <a href="http://www.tinkerer.me/">Tinkerer</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.</footer></div> <!-- footer-container -->

      </div> <!--! end of #container --><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>